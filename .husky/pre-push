#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸš€ Pre-push checks starting..."
echo ""

# Check for uncommitted changes
if ! git diff-index --quiet HEAD --; then
  echo "âš ï¸  Warning: You have uncommitted changes."
  echo "   Consider committing or stashing them before pushing."
  echo ""
fi

# 1. Format check
echo "âœ¨ [1/4] Checking code formatting..."
pnpm format:check || {
  echo ""
  echo "âŒ Code formatting issues found."
  echo "   Run 'pnpm format' to fix automatically."
  exit 1
}
echo "   âœ… Formatting OK"
echo ""

# 2. Type check
echo "ğŸ” [2/4] Running type check..."
pnpm type-check || {
  echo ""
  echo "âŒ Type check failed."
  echo "   Please fix TypeScript errors before pushing."
  exit 1
}
echo "   âœ… Type check passed"
echo ""

# 3. Lint check
echo "ğŸ” [3/4] Running linter..."
pnpm lint || {
  echo ""
  echo "âŒ Linting failed."
  echo "   Please fix linting errors before pushing."
  echo "   Run 'pnpm lint --fix' to auto-fix some issues."
  exit 1
}
echo "   âœ… Linting passed (0 errors, 0 warnings)"
echo ""

# 4. Tests
echo "ğŸ§ª [4/4] Running tests..."
pnpm test || {
  echo ""
  echo "âŒ Tests failed."
  echo "   Please fix failing tests before pushing."
  exit 1
}
echo "   âœ… All tests passed"
echo ""

echo "âœ… All pre-push checks passed! Proceeding with push..."
